<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../bower_components/neon-animation/animations/scale-up-animation.html">
<link rel="import" href="../bower_components/neon-animation/animations/fade-out-animation.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-styles/paper-styles.html">
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="shared-styles.html">

<dom-module id="sub-dialog">
	<template>
		<style include="shared-styles iron-flex iron-flex-alignment">
			:host {
				display : block;
				padding : 10px;
			}

			paper-button.cancel {
				background-color : var(--paper-red-400);
				color            : white;
			}

			paper-button.submit {
				background-color : var(--paper-green-400);
				color            : white;
			}

			paper-dialog {
				z-index : 1000;
			}

			paper-dropdown-menu, .subInput {
				@apply --layout-flex;
				margin : 0 8px;
			}

			paper-tabs {
				background-color                 : var(--google-blue-500);
				color                            : var(--google-grey-100);
				--paper-tabs-selection-bar-color : var(--paper-indigo-800);
				--paper-tabs-selection-bar       : var(--paper-blue-a700);
												 --paper-tabs-selection-bar: {
													 border : 2px solid var(--paper-indigo-800);
												 }
			}

			.textAreas {
				margin : 0;
				color  : var(--google-grey-100);
			}

			@media ( min-width : 767px ) {
				paper-dialog {
					max-width : 30vw;
				}
			}

			@media ( max-width : 767px ) {
				:host {

				}

				.textAreas {
					@apply --layout-vertical;
				}

			}
		</style>

		<iron-ajax id="dbQueryIA"
				   auto
				   url="http://138.85.123.229/php/dbquery.php"
				   content-type="application/x-www-form-urlencoded"
				   method="POST"
				   body="[[params]]"
				   on-response="handleResponse"
				   last-response="{{response}}"
				   on-error="_confirmError">
		</iron-ajax>

		<paper-dialog id="submitDialog"
					  entry-animation="scale-up-animation"
					  exit-animation="fade-out-animation"
					  opened="{{opened}}" with-backdrop>
			<div>
				<h2>Content Submission</h2>
				<p>Please fill out the entire form in order to complete your request.</p>
			</div>
			<paper-dialog-scrollable>
				<div id="submissionForm" class="layout container flex vertical">
					<paper-dropdown-menu id="application"
										 label="Applications"
										 placeholder="Select An Application"
										 value="{{submissionSelections.application}}">
						<paper-listbox slot="dropdown-content" selected="{{submissionSelections.applicationIdx}}">
							<template is="dom-repeat" items="[[applications]]">
								<paper-item value="[[item]]">[[item]]</paper-item>
							</template>
						</paper-listbox>
					</paper-dropdown-menu>
					<div class="subInput">
						<paper-input id="category"
									 label="Category"
									 placeholder="Enter a category"
									 required
									 auto-validate>
						</paper-input>
					</div>
					<div class="subInput">
						<paper-input id="subCategory"
									 label="Sub category"
									 placeholder="Enter a sub category"
									 required
									 auto-validate>
						</paper-input>
					</div>
					<div class="subInput">
						<paper-input id="issue"
									 label="Issue"
									 placeholder="What's the issue?"
									 required
									 auto-validate>
						</paper-input>
					</div>
					<div class="subInput">
						<div class="textAreas">
							<paper-textarea id="script"
											label="Script"
											value="{{subScript}}"
											placeholder="Type or paste your script here">
							</paper-textarea>
						</div>
					</div>
					<div class="subInput">
						<div class="textAreas">
							<paper-textarea id="workInstructions"
											label="Work Instructions"
											value="{{subWorkInstructions}}"
											placeholder="Type or paste related work instructions">
							</paper-textarea>
						</div>
					</div>
					<div class="subInput">
						<paper-input id="docLink"
									 type="url"
									 label="Document URL"
									 placeholder="https://www.someUrl.com">
						</paper-input>
					</div>
				</div>
			</paper-dialog-scrollable>
			<div class="layout horizontal end-justified">
				<paper-button class="cancel" raised on-tap="_closeDialog">
					<iron-icon icon="clear"></iron-icon>
					Cancel
				</paper-button>
				<paper-button class="submit" raised>
					<iron-icon icon="check"></iron-icon>
					Submit
				</paper-button>
			</div>
		</paper-dialog>
	</template>

	<script>
      class SubmissionDialog extends Polymer.Element {
        static get is () {
          return 'sub-dialog';
        }

        static get properties () {
          return {
            applications : Array,

            body : Object,

            docLink : String,

            opened : {
              type  : Boolean,
              value : false
            },

            params : {
              type  : Object,
              value : {
                tools : true
              }
            },

            script : String,

            selectedSubmission : {
              type  : Number,
              value : 0
            },

            submissionSelections : {
              type   : Object,
              notify : true,
              value  : function () {
                return {};
              }
            },

            workInstruction : String
          };
        }

        static get observers () {
          return [
            '_openDialog(opened)'
          ];
        }

        handleResponse ( res ) {

        }

        _confirmError ( err ) {
          this.$.applications.disabled = true;
          console.error( err );
        }

        _selectionChanged ( selection ) {
          let value;

          if ( selection === 'application' ) {
            value = this.selections.application ? selection.application : 'Select an application';
          }
          return value;
        }

        _closeDialog () {
          this.$.submitDialog.cancel();
          this._resetForm();
          this.opened = false;
        }

        _openDialog () {
          if ( this.opened && !this.$.submitDialog.opened ) {
            this.$.submitDialog.open();
          }
        }

        _resetForm () {
          this.$.application.value      = undefined;
          this.$.category.value         = undefined;
          this.$.subCategory.value      = undefined;
          this.$.issue.value            = undefined;
          this.$.script.value           = undefined;
          this.$.workInstructions.value = undefined;
          this.$.docLink.value          = undefined;
        }

        ready () {
          super.ready();
        }
      }

      window.customElements.define( SubmissionDialog.is, SubmissionDialog );
	</script>
</dom-module>
